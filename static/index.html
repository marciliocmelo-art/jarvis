<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Jarvis SaaS</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #343541;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

header {
    padding: 15px;
    text-align: center;
    background-color: #202123;
}

#authArea, #chatArea {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

input {
    margin: 5px;
    padding: 10px;
    width: 250px;
}

button {
    padding: 10px 15px;
    margin: 5px;
    cursor: pointer;
}

#chatContainer {
    flex: 1;
    overflow-y: auto;
    width: 100%;
    max-width: 700px;
    margin-top: 20px;
}

.message {
    padding: 10px;
    margin: 8px;
    border-radius: 6px;
}

.user {
    background-color: #0b93f6;
    text-align: right;
}

.bot {
    background-color: #444654;
}
</style>
</head>

<body>

<header>Jarvis SaaS</header>

<div id="authArea">
    <h3>Login / Cadastro</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="register()">Cadastrar</button>
    <button onclick="login()">Login</button>
</div>

<div id="chatArea" style="display:none;">
    <button onclick="logout()">Logout</button>
    <button onclick="resetChat()">Resetar Conversa</button>

    <div id="chatContainer"></div>

    <input type="text" id="messageInput" placeholder="Digite sua mensagem...">
    <button onclick="sendMessage()">Enviar</button>
</div>

<script>

let token = localStorage.getItem("token");

if (token) {
    showChat();
}

function showChat() {
    document.getElementById("authArea").style.display = "none";
    document.getElementById("chatArea").style.display = "flex";
}

function logout() {
    localStorage.removeItem("token");
    location.reload();
}

async function register() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const response = await fetch("/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
    });

    const data = await response.json();
    alert(data.message || data.detail);
}

async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const response = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
    });

    const data = await response.json();

    if (data.access_token) {
        localStorage.setItem("token", data.access_token);
        token = data.access_token;
        showChat();
    } else {
        alert(data.detail);
    }
}

async function sendMessage() {
    const input = document.getElementById("messageInput");
    const message = input.value;
    if (!message) return;

    addMessage(message, "user");
    input.value = "";

    const response = await fetch("/chat", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ message })
    });

    const data = await response.json();

    addMessage(data.response || data.detail, "bot");
}

async function resetChat() {
    await fetch("/reset", {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + token
        }
    });

    document.getElementById("chatContainer").innerHTML = "";
}

function addMessage(text, type) {
    const div = document.createElement("div");
    div.className = "message " + type;
    div.innerText = text;
    document.getElementById("chatContainer").appendChild(div);
}

</script>

</body>
</html>